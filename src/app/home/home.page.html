<ion-content [fullscreen]="true" class="ion-padding">

  <!-- GPS Permission Warning -->
  <ion-card *ngIf="gpsPermissionDenied" color="warning" class="gps-permission-warning">
    <ion-card-header>
      <ion-card-subtitle class="ion-text-center">
        <strong>Permiso de Ubicaci√≥n Requerido</strong>
      </ion-card-subtitle>
    </ion-card-header>
    <ion-card-content class="ion-text-center">
      <ion-text *ngIf="!showManualInstructions">
        <p>Esta aplicaci√≥n necesita acceso a tu ubicaci√≥n GPS para funcionar correctamente.</p>
        <p>Haz clic en el bot√≥n de abajo para permitir el acceso a tu ubicaci√≥n.</p>
      </ion-text>

      <ion-button
        *ngIf="!showManualInstructions"
        expand="block"
        color="light"
        (click)="retryGpsPermission()"
        class="retry-permission-btn">
        Activar Ubicaci√≥n
      </ion-button>

      <!-- Manual instructions after permission denied -->
      <div *ngIf="showManualInstructions" class="manual-instructions">
        <ion-text color="danger">
          <p><strong>‚ö†Ô∏è Permiso denegado</strong></p>
          <p>El navegador ha bloqueado el acceso a tu ubicaci√≥n. Para activarlo manualmente:</p>
        </ion-text>

        <ion-text>
          <p class="instruction-title"><strong>üì± En este navegador:</strong></p>
          <ol class="instruction-list">
            <li>Toca el icono de <strong>candado üîí</strong> o <strong>informaci√≥n ‚ìò</strong> en la barra de direcciones</li>
            <li>Busca la opci√≥n <strong>"Ubicaci√≥n"</strong> o <strong>"Permisos del sitio"</strong></li>
            <li>Cambia el permiso a <strong>"Permitir"</strong></li>
            <li>Recarga la p√°gina</li>
          </ol>
        </ion-text>

        <ion-button
          expand="block"
          color="medium"
          (click)="showManualInstructions = false"
          class="retry-permission-btn">
          ‚¨ÖÔ∏è Volver
        </ion-button>
      </div>
    </ion-card-content>
  </ion-card>

  <ion-grid class="dashboard-grid" *ngIf="!gpsPermissionDenied">

    <!-- 1. Date Display -->
    <ion-row class="ion-justify-content-center">
      <ion-col size="12" size-md="8">
        <ion-card class="date-card">
          <ion-card-content class="ion-text-center">
            <h2 class="date-text">{{ currentDate }}</h2>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>

    <!-- 2. Digital Speedometer -->
    <ion-row class="ion-justify-content-center speedometer-row">
      <ion-col size="12" size-md="6" class="ion-text-center">
        <div class="speedometer-frame speed-display">
          <div class="speedometer-display">
            <div class="speed-value">{{ currentSpeed | number:'1.0-0' }}</div>
            <div class="speed-unit">KM/H</div>
          </div>
          <div class="speedometer-glow" [class.active]="isTracking"></div>
        </div>
      </ion-col>
    </ion-row>

    <!-- 3. Odometer -->
    <ion-row class="ion-justify-content-center">
      <ion-col size="12" size-md="8">
        <ion-card class="odometer-card">
          <ion-card-header>
            <ion-card-subtitle class="ion-text-center">TOTAL KM</ion-card-subtitle>
          </ion-card-header>
          <ion-card-content class="ion-text-center">
            <h1 class="odometer-digits">{{ totalKilometers | number:'1.2-2' }}</h1>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>

    <!-- 4. Control Button -->
    <ion-row class="ion-justify-content-center">
      <ion-col size="auto" class="ion-text-center">
        <ion-button
          [color]="isTracking ? 'danger' : 'success'"
          [class.recording]="isTracking"
          (click)="toggleTracking()"
          fill="solid"
          shape="round"
          size="large"
          class="control-button">
          <ion-icon
            [name]="isTracking ? 'stop' : 'play'"
            slot="icon-only"
            size="large">
          </ion-icon>
        </ion-button>
      </ion-col>
    </ion-row>

  </ion-grid>

  <!-- Testing buttons (remove in production) -->
  <div class="test-controls">
    <div class="test-label">GPS Simulation (km/h):</div>
    <ion-button
      size="small"
      [fill]="simulatedSpeed === 0 ? 'solid' : 'clear'"
      [color]="simulatedSpeed === 0 ? 'medium' : undefined"
      (click)="testSpeed(0)">
      STOP
    </ion-button>
    <ion-button
      size="small"
      [fill]="simulatedSpeed === 30 ? 'solid' : 'clear'"
      [color]="simulatedSpeed === 30 ? 'primary' : undefined"
      (click)="testSpeed(30)">
      30
    </ion-button>
    <ion-button
      size="small"
      [fill]="simulatedSpeed === 60 ? 'solid' : 'clear'"
      [color]="simulatedSpeed === 60 ? 'primary' : undefined"
      (click)="testSpeed(60)">
      60
    </ion-button>
    <ion-button
      size="small"
      [fill]="simulatedSpeed === 90 ? 'solid' : 'clear'"
      [color]="simulatedSpeed === 90 ? 'primary' : undefined"
      (click)="testSpeed(90)">
      90
    </ion-button>
    <ion-button
      size="small"
      fill="clear"
      color="warning"
      (click)="resetStorage()">
      RESET
    </ion-button>
  </div>

</ion-content>