<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>
      Histórico
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Histórico</ion-title>
    </ion-toolbar>
  </ion-header>

  <!-- Segment Control -->
  <ion-segment [(ngModel)]="selectedView" (ionChange)="onSegmentChanged($event)">
    <ion-segment-button value="entries">
      <ion-label>Registros</ion-label>
    </ion-segment-button>
    <ion-segment-button value="stats">
      <ion-label>Estadísticas</ion-label>
    </ion-segment-button>
  </ion-segment>

  <!-- Entries View -->
  <div *ngIf="selectedView === 'entries'">
    <!-- Entries List -->
    <ion-card *ngIf="entries.length > 0">
      <ion-card-header>
        <ion-card-title>Tus Registros</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-list>
          <ion-item-sliding *ngFor="let entry of entries">
            <ion-item>
              <ion-icon [name]="getTypeIcon(entry.type)" slot="start"></ion-icon>
              <ion-label>
                <h3>{{ entry.kilometers | number:'1.1-1' }} km</h3>
                <p>{{ getTypeLabel(entry.type) }} • {{ formatDate(entry.date) }}</p>
                <p *ngIf="entry.description">{{ entry.description }}</p>
              </ion-label>
            </ion-item>
            <ion-item-options side="end">
              <ion-item-option color="danger" (click)="deleteEntry(entry.id)">
                <ion-icon slot="icon-only" name="trash"></ion-icon>
              </ion-item-option>
            </ion-item-options>
          </ion-item-sliding>
        </ion-list>
      </ion-card-content>
    </ion-card>

    <!-- No Data Message -->
    <ion-card *ngIf="entries.length === 0">
      <ion-card-content>
        <div style="text-align: center; padding: 20px;">
          <ion-icon name="calendar" size="large" color="medium"></ion-icon>
          <h2>Sin registros aún</h2>
          <p>¡Comienza a rastrear tus kilómetros desde la pestaña Home!</p>
        </div>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Statistics View -->
  <div *ngIf="selectedView === 'stats'">
    <!-- Total Summary -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="stats-chart"></ion-icon>
          Resumen Total
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div style="text-align: center;">
          <h1 style="color: var(--ion-color-primary); margin: 0;">{{ totalKm | number:'1.1-1' }} km</h1>
          <p>Distancia Total Recorrida</p>
          <p><strong>{{ entries.length }}</strong> registros guardados</p>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- By Activity Type -->
    <ion-card *ngIf="getObjectKeys(kmByType).length > 0">
      <ion-card-header>
        <ion-card-title>Por Tipo de Actividad</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-list>
          <ion-item *ngFor="let type of getObjectKeys(kmByType)">
            <ion-icon [name]="getTypeIcon(type)" slot="start"></ion-icon>
            <ion-label>
              <h3>{{ getTypeLabel(type) }}</h3>
            </ion-label>
            <ion-badge slot="end" color="primary">
              {{ kmByType[type] | number:'1.1-1' }} km
            </ion-badge>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>

    <!-- By Month -->
    <ion-card *ngIf="getObjectKeys(kmByMonth).length > 0">
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="calendar"></ion-icon>
          Desglose Mensual
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-list>
          <ion-item *ngFor="let month of getObjectKeys(kmByMonth)">
            <ion-label>
              <h3>{{ getMonthLabel(month) }}</h3>
            </ion-label>
            <ion-badge slot="end" color="secondary">
              {{ kmByMonth[month] | number:'1.1-1' }} km
            </ion-badge>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>

    <!-- No Data Message for Stats -->
    <ion-card *ngIf="entries.length === 0">
      <ion-card-content>
        <div style="text-align: center; padding: 20px;">
          <ion-icon name="stats-chart" size="large" color="medium"></ion-icon>
          <h2>Sin datos aún</h2>
          <p>¡Comienza a rastrear tus kilómetros para ver las estadísticas aquí!</p>
        </div>
      </ion-card-content>
    </ion-card>
  </div>

</ion-content>